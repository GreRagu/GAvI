<!DOCTYPE article PUBLIC "-//NLM//DTD Journal Archiving and Interchange DTD v2.3 20070202//EN" "archivearticle.dtd"><article xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article"><?properties open_access?><front><journal-meta><journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id><journal-title>BMC Bioinformatics</journal-title><issn pub-type="epub">1471-2105</issn><publisher><publisher-name>BioMed Central</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmid">19014579</article-id><article-id pub-id-type="pmc">2636811</article-id><article-id pub-id-type="publisher-id">1471-2105-9-481</article-id><article-id pub-id-type="doi">10.1186/1471-2105-9-481</article-id><article-categories><subj-group subj-group-type="heading"><subject>Methodology Article</subject></subj-group></article-categories><title-group><article-title>Gene set enrichment analysis for non-monotone association and multiple experimental categories</article-title></title-group><contrib-group><contrib id="A1" corresp="yes" contrib-type="author"><name><surname>Lin</surname><given-names>Rongheng</given-names></name><xref ref-type="aff" rid="I1">1</xref><email>rlin@schoolph.umass.edu</email></contrib><contrib id="A2" contrib-type="author"><name><surname>Dai</surname><given-names>Shuangshuang</given-names></name><xref ref-type="aff" rid="I2">2</xref><email>dai3@niehs.nih.gov</email></contrib><contrib id="A3" contrib-type="author"><name><surname>Irwin</surname><given-names>Richard D</given-names></name><xref ref-type="aff" rid="I3">3</xref><email>irwin@niehs.nih.gov</email></contrib><contrib id="A4" contrib-type="author"><name><surname>Heinloth</surname><given-names>Alexandra N</given-names></name><xref ref-type="aff" rid="I4">4</xref><email>heinloth@gmail.com</email></contrib><contrib id="A5" contrib-type="author"><name><surname>Boorman</surname><given-names>Gary A</given-names></name><xref ref-type="aff" rid="I5">5</xref><email>Gary.Boorman@covance.com</email></contrib><contrib id="A6" corresp="yes" contrib-type="author"><name><surname>Li</surname><given-names>Leping</given-names></name><xref ref-type="aff" rid="I1">1</xref><email>li3@niehs.nih.gov</email></contrib></contrib-group><aff id="I1"><label>1</label>Biostatistics Branch, National Institute of Environmental Health Science, Research Triangle Park, NC 27713, USA</aff><aff id="I2"><label>2</label>Alpha-Gamma Technologies, Inc., Raleigh NC 27609, USA</aff><aff id="I3"><label>3</label>Environmental Toxicology Program, National Institute of Environmental Health Science, Research Triangle Park, NC 27713, USA</aff><aff id="I4"><label>4</label>Laboratory of Molecular Toxicology, National Institute of Environmental Health Science, Research Triangle Park, NC 27713, USA</aff><aff id="I5"><label>5</label>Covance Inc., Vienna, VA 22066, USA</aff><pub-date pub-type="collection"><year>2008</year></pub-date><pub-date pub-type="epub"><day>14</day><month>11</month><year>2008</year></pub-date><volume>9</volume><fpage>481</fpage><lpage>481</lpage><ext-link ext-link-type="uri" xlink:href="http://www.biomedcentral.com/1471-2105/9/481"/><history><date date-type="received"><day>25</day><month>7</month><year>2007</year></date><date date-type="accepted"><day>14</day><month>11</month><year>2008</year></date></history><permissions><copyright-statement>Copyright &#x000a9; 2008 Lin et al; licensee BioMed Central Ltd.</copyright-statement><copyright-year>2008</copyright-year><copyright-holder>Lin et al; licensee BioMed Central Ltd.</copyright-holder><license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0"><p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0"/>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</p><!--<rdf xmlns="http://web.resource.org/cc/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:dc="http://purl.org/dc/elements/1.1" xmlns:dcterms="http://purl.org/dc/terms"><Work xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" rdf:about=""><license rdf:resource="http://creativecommons.org/licenses/by/2.0"/><dc:type rdf:resource="http://purl.org/dc/dcmitype/Text"/><dc:author>               Lin               Rongheng                              rlin@schoolph.umass.edu            </dc:author><dc:title>            Gene set enrichment analysis for non-monotone association and multiple experimental categories         </dc:title><dc:date>2008</dc:date><dcterms:bibliographicCitation>BMC Bioinformatics 9(1): 481-. (2008)</dcterms:bibliographicCitation><dc:identifier type="sici">1471-2105(2008)9:1&#x0003c;481&#x0003e;</dc:identifier><dcterms:isPartOf>urn:ISSN:1471-2105</dcterms:isPartOf><License rdf:about="http://creativecommons.org/licenses/by/2.0"><permits rdf:resource="http://web.resource.org/cc/Reproduction" xmlns=""/><permits rdf:resource="http://web.resource.org/cc/Distribution" xmlns=""/><requires rdf:resource="http://web.resource.org/cc/Notice" xmlns=""/><requires rdf:resource="http://web.resource.org/cc/Attribution" xmlns=""/><permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" xmlns=""/></License></Work></rdf>--></license></permissions><abstract><sec><title>Background</title><p>Recently, microarray data analyses using functional pathway information, e.g., gene set enrichment analysis (GSEA) and significance analysis of function and expression (SAFE), have gained recognition as a way to identify biological pathways/processes associated with a phenotypic endpoint. In these analyses, a local statistic is used to assess the association between the expression level of a gene and the value of a phenotypic endpoint. Then these gene-specific local statistics are combined to evaluate association for pre-selected sets of genes. Commonly used local statistics include t-statistics for binary phenotypes and correlation coefficients that assume a linear or monotone relationship between a continuous phenotype and gene expression level. Methods applicable to continuous non-monotone relationships are needed. Furthermore, for multiple experimental categories, methods that combine multiple GSEA/SAFE analyses are needed.</p></sec><sec><title>Results</title><p>For continuous or ordinal phenotypic outcome, we propose to use as the local statistic the coefficient of multiple determination (i.e., the square of multiple correlation coefficient) <italic>R</italic><sup>2 </sup>from fitting natural cubic spline models to the phenotype-expression relationship. Next, we incorporate this association measure into the GSEA/SAFE framework to identify significant gene sets. Unsigned local statistics, signed global statistics and one-sided p-values are used to reflect our inferential interest. Furthermore, we describe a procedure for inference across multiple GSEA/SAFE analyses. We illustrate our approach using gene expression and liver injury data from liver and blood samples from rats treated with eight hepatotoxicants under multiple time and dose combinations. We set out to identify biological pathways/processes associated with liver injury as manifested by increased blood levels of alanine transaminase in common for most of the eight compounds. Potential statistical dependency resulting from the experimental design is addressed in permutation based hypothesis testing.</p></sec><sec><title>Conclusion</title><p>The proposed framework captures both linear and non-linear association between gene expression level and a phenotypic endpoint and thus can be viewed as extending the current GSEA/SAFE methodology. The framework for combining results from multiple GSEA/SAFE analyses is flexible to address practical inference interests. Our methods can be applied to microarray data with continuous phenotypes with multi-level design or the meta-analysis of multiple microarray data sets.</p></sec></abstract></article-meta></front><body><sec><title>Background</title><p>Microarray technology profiles the expression levels of thousands of genes simultaneously, providing a snapshot of transcript levels in the cells/tissues being studied. Analysis of microarray data typically involves examining thousands of genes with relatively small sample sizes, and thus is challenging for statisticians [<xref ref-type="bibr" rid="B1">1</xref>,<xref ref-type="bibr" rid="B2">2</xref>]. Moreover, deriving useful biological knowledge from these gene sets is often a long and arduous task. Recently, however, methods have been developed that incorporate existing knowledge of biological pathways/processes into the analysis. For example, gene set enrichment analysis (GSEA) tests whether a known set of genes is associated with a phenotypic difference [<xref ref-type="bibr" rid="B3">3</xref>]. In GSEA, an enrichment score (ES) for a predefined gene set, usually a known biological pathway/process, is calculated and statistical significance is evaluated. GSEA was refined by [<xref ref-type="bibr" rid="B4">4</xref>] and a more general framework, significance analysis of function and expression (SAFE) was proposed by [<xref ref-type="bibr" rid="B5">5</xref>]. Furthermore, ES vectors for gene sets can be defined for individual samples and used for classification [<xref ref-type="bibr" rid="B6">6</xref>]. In these procedures, an association measure between a phenotypic endpoint and expression levels is calculated and subsequently used as the basis for further evaluation of the association between gene sets and the same phenotypic endpoint. Additional work on GSEA type methods can be found in [<xref ref-type="bibr" rid="B7">7</xref>-<xref ref-type="bibr" rid="B11">11</xref>].</p><p>Numerous statistics have been proposed to identify differentially expressed genes when the phenotype is binary [<xref ref-type="bibr" rid="B12">12</xref>-<xref ref-type="bibr" rid="B17">17</xref>]. All these statistics can be used to measure the association between gene expression levels and a binary phenotype. When a phenotypic endpoint is continuous, correlation analysis between gene expression and the phenotypic variable emerges naturally. A correlation measurement needs to be selected based on the goal of the investigation, biological interpretation, statistical properties and computational feasibility. The commonly used Pearson product-moment correlation coefficient measures linear association, whereas the non-parametric Spearman correlation measures monotone trend. A brief summary of several commonly used correlation measurements and their limitations can be found in [<xref ref-type="bibr" rid="B18">18</xref>]. Alternatively, the standardized Z-type statistics resulting from univariate Cox proportional hazard model has been proposed as the local statistics for the situation where continuous survival time with censoring is the phenotypic endpoint [<xref ref-type="bibr" rid="B5">5</xref>].</p><p>In biological research using microarray technology, gene expression data are often collected under multiple experimental conditions, along with traditional pathological endpoints [<xref ref-type="bibr" rid="B19">19</xref>]. One practical inferential goal is to identify biological pathways/processes that are associated with the endpoint and thus gain insight into biological mechanisms of tissue response to the experimental conditions. Under the framework of GSEA/SAFE, inference is based on assessing the association between expression levels of predefined sets of genes and the phenotypic endpoint. When associations between the phenotypic endpoint and the gene expressions are likely to be non-linear or non-monotone, the local statistics, which is the measurement of gene specific association to the endpoint, should be able to capture these, while a linear or monotone situation should still be accommodated. We propose to use the coefficient of multiple determination <italic>R</italic><sup>2 </sup>from a natural cubic spline model [<xref ref-type="bibr" rid="B20">20</xref>]. The spline model allows us to capture potential non-linear and non-monotone trends. The quantity <italic>R</italic><sup>2 </sup>is then used as the correlation in GSEA/SAFE to identify gene sets that are associated with the phenotypic endpoints.</p><p>When experimental conditions include multiple categories, different biological mechanisms might be expected and separate association analyses for each category are desired before aggregating to arrive at the final conclusion. We carry out separate enrichment analysis in each category and propose an <italic>ad hoc </italic>procedure to combine the results.</p><p>In this article, the words "association" and "correlation" are used interchangeably in most situations.</p></sec><sec><title>Results and discussion</title><p>We describe the methods for separate analysis in each category in Section 2.1 and 2.2, then inference across categories in Section 2.3. The methods are then illustrated using National Center of Toxicogenomics (NCT) compendium data in Section 2.4.</p><p>The relevant R code is available at <ext-link ext-link-type="uri" xlink:href="http://people.umass.edu/rlin/niehs/r2/R2GSEA.R"/>.</p><sec><title>2.1 Non-linear association measurement</title><p>In all methods for the evaluation of gene sets discussed in the introduction, the association measure between a gene set and an endpoint is built from the association measures between individual genes and the endpoint. We would like a gene specific association measure to have several properties. First, it should be scale free, i.e., it would not change when data are linearly transformed. This property guarantees that in data preprocessing, different bases in log transformation (e.g., log<sub>2 </sub>or log<sub>10</sub>) give the same inferential conclusion. Second, it should accommodate non-linear or non-monotone associations between variables. Third, it should allow limited data points. Fourth, it should be easy to compute and interpret. These considerations exclude the usage of many non-linear correlation functions and measures, e.g., [<xref ref-type="bibr" rid="B21">21</xref>]. We propose to use the coefficient of multiple determination <italic>R</italic><sup>2 </sup>in natural cubic spline regression models to measure the gene specific association. This quantity can be interpreted as the fraction of the variation in endpoints that can be explained by the gene expression data. When the association is linear, this quantity is approximately equal to the square of Pearson correlation.</p><p>For experimental category <italic>c</italic>, <italic>c </italic>= 1, 2, &#x022ef;, <italic>C</italic>, we denote <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M1" name="1471-2105-9-481-i1" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> as the continuous or ordinal endpoint measurement of sample <italic>i</italic>, and <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M2" name="1471-2105-9-481-i2" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> as the expression level of gene <italic>g</italic><sub><italic>j </italic></sub>in sample <italic>i</italic>. The respective experimental condition of sample <italic>i </italic>is denoted as <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M3" name="1471-2105-9-481-i3" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula>. The category can be defined by tumor types, compounds, etc., and <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M4" name="1471-2105-9-481-i3" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> can contain other experimental factors, e.g., time and dose. Let <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M5" name="1471-2105-9-481-i4" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>&#x003f5;</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> be the random noise satisfying E[<inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M6" name="1471-2105-9-481-i4" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>&#x003f5;</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula>] = 0. For convenience, the superscript <italic>c </italic>is suppressed in <italic>X</italic>, <italic>Y</italic>, <italic>e </italic>and <italic>&#x003b5; </italic>without causing confusion in the sequel. We assume equation (1), i.e., the endpoint depends on experiment conditions in a way that is functionally related to gene expression levels:</p><p><disp-formula id="bmcM1"><label>(1)</label><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M7" name="1471-2105-9-481-i5" overflow="scroll"><mml:semantics><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>e</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003f5;</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003f5;</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003f5;</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>We define</p><p><disp-formula id="bmcM2"><label>(2)</label><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M8" name="1471-2105-9-481-i6" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>X</mml:mi></mml:mstyle><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>&#x02212;</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x02212;</mml:mo><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>to assess the association between <bold>X</bold><sub><italic>j </italic></sub>and <bold>Y</bold>, where <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M9" name="1471-2105-9-481-i7" overflow="scroll"><mml:semantics><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:semantics></mml:math></inline-formula> can be estimated by regression method accommodating possible non-linear trends. Here we use natural cubic splines, which are cubic splines with linear extension out of the boundary knots [<xref ref-type="bibr" rid="B20">20</xref>,<xref ref-type="bibr" rid="B22">22</xref>]. This flexible approach guarantees that both non-linear and linear trends are well captured. When a linear trend is the only desired type of association, we can simply change the splines into linear terms and the proposed methods can still be used.</p><p>The calculation of the quantity <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M10" name="1471-2105-9-481-i8" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> has two main steps:</p><p>&#x02022; Specify inside knots at <italic>b </italic>evenly spread quantiles of <bold>X</bold><sub><italic>j</italic></sub>. Generate B-spline basis matrix for natural cubic spline <italic>B</italic>(<italic>X</italic><sub><italic>j</italic></sub>)<sub><italic>n </italic>&#x000d7; (<italic>b</italic>+2) </sub>from <bold>X</bold><sub><italic>j </italic></sub>(<italic>b </italic>+ 1 spline terms and one intercept term). We used <italic>ns() </italic>function in the <italic>splines </italic>package of <italic>R </italic>[<xref ref-type="bibr" rid="B23">23</xref>].</p><p>&#x02022; Regress <bold>Y </bold>on <italic>B</italic>(<bold>X</bold><sub><italic>j</italic></sub>) and obtain the <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M11" name="1471-2105-9-481-i8" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> value. We use <italic>QR </italic>decomposition routine <italic>qr() </italic>in <italic>R </italic>directly to avoid extraneous computation for other statistics such as coefficient estimates, standard errors, etc., that would occur if using the linear model regression routine <italic>lm()</italic>.</p><p>The piecewise cubic splines approach, unlike the regular <italic>b </italic>+ 1 degree polynomials, automatically provides the roughness penalty [<xref ref-type="bibr" rid="B24">24</xref>], which control the degree of ripples in fitted curve. Gene specific quantiles are easy to compute and guarantee enough sample points between knots. Some alternative ways, e.g., using global quantiles of all <bold>X</bold><sub><italic>j</italic></sub>, do not have this property and would make poor fitting for some genes. For the number of knots to be used in splines model, "a minimum of 5 points should be between knot locations" has been suggested [<xref ref-type="bibr" rid="B25">25</xref>]. The selection of <italic>b </italic>depends on the available sample size and desired flexibility in capturing non-linear trend.</p></sec><sec><title>2.2 Adapted GSEA procedure</title><p>Given a gene set in an array, there have been two types of set specific global statistics [<xref ref-type="bibr" rid="B8">8</xref>]: "self-contained" one using only genes in the set and "competitive" one using all genes in the array. Approaches proposed in [<xref ref-type="bibr" rid="B26">26</xref>,<xref ref-type="bibr" rid="B27">27</xref>] belong to the first type and GSEA/SAFE approach belongs to the second type. Computationally, when there are only a small number of gene sets to test, "self-contained" approaches are much faster by avoiding the genes out of the sets.</p><p>GSEA method is designed to test whether a <italic>pre-built </italic>gene set is associated with the phenotype. Its kernel Kolmogorov-Smirnov statistic detects the difference of gene positions in the ranked gene list between one gene set and its complementary set. The method can thus highlight a gene set that has similar associations (and ranks) for each gene in the set. When the identified set of genes cluster close to the bottom of the ranked list ordered by association strength, the set is likely to be of limited interest to biologists [<xref ref-type="bibr" rid="B27">27</xref>-<xref ref-type="bibr" rid="B29">29</xref>]. Also, the method is biased toward those well-studied gene sets [<xref ref-type="bibr" rid="B8">8</xref>].</p><p>Belonging to the "self-contained" type, Goeman et al. (2004)'s approach [<xref ref-type="bibr" rid="B26">26</xref>] proposed to fit a random effect model for each gene set and has the potential to accommodate non-linear terms conveniently. It assumed the coefficients of genes are independent and otherwise a proper covariance matrix needs to be set up. When used with non-linear terms, the independence assumption thus need to be justified or more exploration on the proper covariance matrix specification will be expected. Once independence assumption holds or proper covariance matrix can be specified, the approach will be very attractive in computation.</p><p>GSEA/SAFE (and SAM-GS [<xref ref-type="bibr" rid="B27">27</xref>]) calculate one measurement for each gene and then for each gene set, accumulate the genes' signals into one for the whole gene set. For each gene, there is only one association measurement. Goeman et al. (2004) fits models directly for each gene set. The coefficients of the same gene in different gene sets could then be different and do not have direct interpretation of association strength, while there exist many other advantages for "self contained" approaches [<xref ref-type="bibr" rid="B8">8</xref>].</p><p>We construct the global statistics measuring the association between the phenotype and the pre-built sets of genes based on <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M12" name="1471-2105-9-481-i8" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> as local statistics. We adapt the modified version of GSEA [<xref ref-type="bibr" rid="B4">4</xref>] where genes with stronger association are assigned higher weight. The method does not require the independence assumption between genes. In each category <italic>c </italic>we define enrichment score (ES) for gene set <italic>s</italic>:</p><p>&#x02022; Rank all <italic>J </italic>genes to form list <italic>L </italic>= {<italic>g</italic><sub>1</sub>, ..., <italic>g</italic><sub><italic>J</italic></sub>} decreasing in <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M13" name="1471-2105-9-481-i8" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula>.</p><p>&#x02022; Evaluate the fraction of genes in <italic>s </italic>("hits") weighted by <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M14" name="1471-2105-9-481-i8" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> and the fraction of genes not in <italic>s </italic>("misses") present up to a given position <italic>k </italic>in <italic>L</italic>.</p><p><disp-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M15" name="1471-2105-9-481-i9" overflow="scroll"><mml:semantics><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>&#x02208;</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>&#x02264;</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mtext>where&#x000a0;</mml:mtext><mml:msub><mml:mi>N</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>&#x02208;</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>&#x02209;</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>&#x02264;</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>J</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mtext>where&#x000a0;</mml:mtext><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mtext>&#x000a0;is&#x000a0;the&#x000a0;number&#x000a0;of&#x000a0;genes&#x000a0;in&#x000a0;</mml:mtext><mml:mi>s</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>&#x02022; ES(s, c) is the <italic>signed </italic>maximum deviation from zero of <italic>P</italic><sub><italic>hit</italic></sub>(<italic>s</italic>, <italic>c</italic>, <italic>k</italic>) - <italic>P</italic><sub><italic>miss</italic></sub>(<italic>s</italic>, <italic>c</italic>, <italic>k</italic>) over <italic>k</italic>.</p><p>For a ranked gene list based on <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M16" name="1471-2105-9-481-i8" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula>, our inferential interest is on the top of the list, rather than both extremes as when ranking is based on t-statistics or Pearson correlations. This feature makes those sets with both positively and negatively correlated genes easier to identify than if using signed correlation measurements. Gene sets clustering at the top of the list will have positive maximum deviation and those clustering at the bottom of the list will have negative maximum deviation. Consequently, we use one sided p-values rather than two-sided p-values to indicate the significance of gene sets. A gene set cluster at the bottom of the list, which is off our interest, will have a p-value close to 1 and will not be highlighted. A signed local statistics, unsigned ES and two-side p-values were used in [<xref ref-type="bibr" rid="B4">4</xref>].</p><p>We calculate these p-values with permutations. We permute the phenotypic endpoint variable <bold>Y </bold>1000 times to generate 1000 permuted data sets and calculate the ES values for each permutation. These ES values form the null distribution of ES to estimate the p-value of the observed ES value. This permutation method retains the correlation structure among the genes. More discussion on the permutation details is deferred to Section 2.4.2.</p></sec><sec><title>2.3 Inference across experimental categories</title><p>In the standard framework of GSEA/SAFE, analysis is carried out only for one category. However, with multiple categories of experimental settings, "identifying biological pathways" that are associated with phenotypic changes in most categories" is a practically important inferential goal. When association patterns differ under different categories, pooling data is not a good option for either biological interpretation or statistical inference.</p><p>For a gene set <italic>s</italic>, separate analyses in <italic>C </italic>categories generate a p-value vector of length <italic>C</italic>. At first glance, Fisher's method of combining p-values [<xref ref-type="bibr" rid="B30">30</xref>] could be used along with false discovery rate (FDR) to select a threshold [<xref ref-type="bibr" rid="B31">31</xref>,<xref ref-type="bibr" rid="B32">32</xref>]. However, the goal of our method is to identify gene sets that are related to phenotypic changes for most of the categories, while Fisher's method could lead to very high significance even if strong association is observed in only one category. Therefore, we propose a subjective but stringent criterion to evaluate gene sets across categories.</p><p>Let <italic>P</italic><sub><italic>s</italic>, <italic>c </italic></sub>be the p-value of set <italic>s </italic>for category <italic>c</italic>. To call one set significant across the <italic>C </italic>categories, we require at least <italic>M </italic>of <italic>C </italic>p-values <italic>P</italic><sub><italic>s</italic>,1</sub>, <italic>P</italic><sub><italic>s</italic>,2</sub>, &#x022ef;, <italic>P</italic><sub><italic>s</italic>, <italic>C </italic></sub>be less than <italic>p</italic><sub>0</sub>, 1 &#x02264; <italic>M </italic>&#x02264; <italic>C</italic>. In this study, we assume that the values of <italic>M </italic>and <italic>C </italic>are known fixed integers and will drop them from notations for convenience. Formally, the sets identified are defined as:</p><p><disp-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M17" name="1471-2105-9-481-i10" overflow="scroll"><mml:semantics><mml:mrow><mml:mi>A</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>s</mml:mi><mml:mo>:</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>C</mml:mi></mml:munderover><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&#x0003c;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02265;</mml:mo><mml:mi>M</mml:mi><mml:mo>}</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>s</mml:mi><mml:mo>:</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo>&#x0003c;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>where <italic>P</italic><sub><italic>s</italic>,(<italic>M</italic>) </sub>is the <italic>M</italic><sup><italic>th </italic></sup>smallest of the <italic>C </italic>p-values <italic>P</italic><sub><italic>s</italic>,1</sub>, <italic>P</italic><sub><italic>s</italic>,2</sub>, &#x022ef;, <italic>P</italic><sub><italic>s</italic>, <italic>C</italic></sub>. By adjusting the value of <italic>p</italic><sub>0</sub>, we can control the number of sets that meet the criteria.</p><p>Under a <italic>global null hypothesis</italic>, the gene set is not associated with phenotypic changes in any category and <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M18" name="1471-2105-9-481-i11" overflow="scroll"><mml:semantics><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:semantics></mml:math></inline-formula> in equation (1) equal to zero for each <italic>c</italic>; all <italic>C </italic>p-values independently have a Uniform(0,1) distribution. A direct calculation of the type I error rate <italic>&#x003b1; </italic>based on the proposed rule, using <italic>p</italic><sub>0 </sub>is</p><p><disp-formula id="bmcM3"><label>(3)</label><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M19" name="1471-2105-9-481-i12" overflow="scroll"><mml:semantics><mml:mrow><mml:mi>&#x003b1;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02264;</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mi>M</mml:mi></mml:mrow><mml:mi>C</mml:mi></mml:munderover><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>C</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>m</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msup><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>&#x02212;</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>An example given in Section 2.4 calculates <italic>&#x003b1;</italic>(<italic>p</italic><sub>0</sub>) in similar way for more complicated practical inferential goal. One benefit of this approach is that it does not require p-values in very high precision, avoiding computational burden in permutation based hypothesis testing. See Section 2.4.2 for further discussion.</p><p>For each <italic>p</italic><sub>0</sub>, a conservative estimation of the FDR bound can be given by the definition [<xref ref-type="bibr" rid="B31">31</xref>]:</p><p><disp-formula id="bmcM4"><label>(4)</label><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M20" name="1471-2105-9-481-i13" overflow="scroll"><mml:semantics><mml:mrow><mml:mi>F</mml:mi><mml:mi>D</mml:mi><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02264;</mml:mo><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mi>&#x003b1;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>A</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>where <italic>S </italic>is the number of gene sets and |<italic>A</italic>| is the cardinality of <italic>A</italic>. The bound is inflated because it assumes that none of <italic>S </italic>gene sets are associated with the phenotypic changes. When |<italic>A| </italic>= 0, i.e., none of the gene sets is identified, FDR is 0 by definition. Since in most of cases, <italic>&#x003b1;</italic>(<italic>p</italic><sub>0</sub>) is so small that this bound is small enough for practical usage. When more advanced FDR control methods are desired, extra assumptions, e.g., the independence between gene sets might be needed.</p><p>We note that under the global null hypothesis, it is straightforward to show that random variable <italic>P</italic><sub><italic>s</italic>,(<italic>M</italic>) </sub>follows the <italic>Beta</italic>(<italic>M </italic>- 1, <italic>C </italic>- <italic>M</italic>) distribution. We can use p-values of observed <italic>P</italic><sub><italic>s</italic>,(<italic>M</italic>) </sub>to select gene sets and evaluate the type I error rate, which provides an equivalent alternative to equation (3). By this approach, the set-specific FDR can be calculated based on the empirical distribution of set-specific p-values [<xref ref-type="bibr" rid="B31">31</xref>,<xref ref-type="bibr" rid="B32">32</xref>].</p><p>One alternative approach for inference across categories is to control the category specific FDR and then combine the results. Depending on the goal, the unions or intersections of <italic>C </italic>lists of gene sets identified by proper FDR thresholds can be used. However, approaches to estimate the FDR usually require very precise estimation of p-values [<xref ref-type="bibr" rid="B33">33</xref>] and 1000 permutations can produce p-values with the granularity up to 0.001. Several methods have been proposed on this issue: assuming the normalized null of ES for different sets are the same and pooling them to obtain a global null distribution with much finer granularity [<xref ref-type="bibr" rid="B3">3</xref>,<xref ref-type="bibr" rid="B4">4</xref>]; using a linear combination of t-statistics as the global statistic, which asymptotically has normal distribution [<xref ref-type="bibr" rid="B7">7</xref>]; using more permutations (eg., 10,000 times) to generate a set-specific null distribution [<xref ref-type="bibr" rid="B5">5</xref>]. However, asymptotic results for <italic>R</italic><sup>2 </sup>(and thus ES) may not be available as discussed further in additional file <xref ref-type="supplementary-material" rid="S1">1</xref>, section 1. For a large data set with many categories, 10,000 permutations would constitute a substantial computational burden. More importantly, it is unclear how the category-wise FDRs should be combined into one interpretable summary statistic. To the best of our knowledge, no literature is available on this issue.</p></sec><sec><title>2.4 Analysis of NCT compendium data</title><p>The National Center for Toxicogenomics (NCT) compendium data were recently developed at National Institute of Environmental Health Science (NIEHS), NIH. Agilent cDNA oligonucleotide microarrays were used to profile the expression level of 20500 genes from both the liver and blood of male rats (Rattus norvegicus, F344/N strain) treated with 8 hepatotoxic compounds: bromobenzene, 1; 2-dichlorobenzene, 1; 4-dichlorobenzene, diquat dibromide (diquat), galactosamine, monocrotaline, n-nitrosomorpholine and thioacetamide, each at multiple time-dose combinations. These 8 compounds target different cell types and regions in the liver, and thus each compound in each tissue is considered a category. There were 4&#x02013;6 replicates per condition and a total of 318 treated animals. Table <xref ref-type="table" rid="T1">1</xref> lists the data structure. Many pathological phenotypic endpoints were collected for the samples and we use a liver injury indicator, alanine transaminase (ALT) level as the outcome variable <bold>Y </bold>in the following analysis. More details on experimental design, histopathology, and clinical chemistry can be found in [<xref ref-type="bibr" rid="B34">34</xref>].</p><table-wrap position="float" id="T1"><label>Table 1</label><caption><p>NCT compendium microarray data. In time rows, the numbers from 0 to 3 indicate vehicle, low, medium and high doses. </p></caption><table frame="hsides" rules="groups"><thead><tr><td align="center">Compound</td><td align="center">1.2.Di</td><td align="center">1.4.Di</td><td align="center">Brom</td><td align="center">Diqu</td><td align="center">Gala</td><td align="center">Mono</td><td align="center">N-Nitr</td><td align="center">Thio</td></tr></thead><tbody><tr><td align="center">6 Hrs</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;4</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td></tr><tr><td align="center">24 Hrs</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;4</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td></tr><tr><td align="center">48 Hrs</td><td align="center">0&#x02013;3*</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;4</td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;2<sup>&#x02020;</sup></td><td align="center">0&#x02013;3</td><td align="center">0&#x02013;3</td></tr><tr><td align="center">Replicates</td><td align="center">4</td><td align="center">4</td><td align="center">4</td><td align="center">6</td><td align="center">4</td><td align="center">4</td><td align="center">4</td><td align="center">4</td></tr><tr><td align="center">Array totals</td><td align="center">34</td><td align="center">36</td><td align="center">36</td><td align="center">72</td><td align="center">36</td><td align="center">32</td><td align="center">36</td><td align="center">36</td></tr></tbody></table><table-wrap-foot><p>Diquat dibromide has 4 levels. Array numbers do not include vehicle treated animals, which were used as baseline in cDNA microarray. *: Two animals in high dose group died before 48 hours. &#x02020;: All four animals in high dose group died before 48 hours.</p></table-wrap-foot></table-wrap><p>In microarray data analysis, expression ratios are often log transformed for analysis convenience. Since ALT levels range from generally less than 100 units (I.U/ml) in vehicle treated animals to several thousand units after exposure to a hepatotoxicant, log transformation of ALT levels is also necessary. In the following, we use gene expression level to refer to the log<sub>2 </sub>ratio of gene expression levels of treated rats to the control rats. Similarly, we use ALT level to refer to the log<sub>10 </sub>ratio of ALT levels of treated rats to the mean of those in respective group of vehicle treated rats (see Table <xref ref-type="table" rid="T1">1</xref>). The different log transformation bases are for reading and presenting convenience only and do not change our inferential conclusion as noted in Section 2.1. Figure <xref ref-type="fig" rid="F1">1</xref> show some examples of observed non-linear and non-monotone relationships between ALT level and gene expression levels. A smoothing line using all data is provided as baseline in the figure; the different compounds depart from this smooth line in different patterns, indicating compound specific spline fittings should be used.</p><fig position="float" id="F1"><label>Figure 1</label><caption><p><bold>log<sub>10</sub>(ALT ratio) vs log<sub>2</sub>(gene expression ratio).</bold> Examples of non-monotone relationship in liver between expression levels of two genes and ALT. Each color represents one compound, and symbols (&#x025cb;, &#x00394;, +) indicate the low, medium and high doses respectively. For the compound (diquat) with four dose levels, symbol "&#x000d7;" indicates the highest dose. Time information is not indicated. The smoothing line is fitted using all data, with natural cubic splines.</p></caption><graphic xlink:href="1471-2105-9-481-1"/></fig><p>We assume that the ALT depends on time and dose in a way that is functionally related to gene expression levels, i.e., <italic>e</italic><sub><italic>i </italic></sub>in equation 1 contains time and dose information. We let <italic>b</italic>, the number of inside knots as described in Section 2.1, equal 4. It is close to the maximum number we can afford with 32&#x02013;72 samples per compound, following the suggestion "a minimum of 5 points should be between knot locations" [<xref ref-type="bibr" rid="B25">25</xref>]. With the degrees of freedom equal 5 (4 inside knots), the model is flexible enough to capture major biologically plausible departures from linear or monotone trend. The same spline space has been used in [<xref ref-type="bibr" rid="B13">13</xref>] to calculate a gene's posterior "probability" of differential expression through logistic regression.</p><p>Without gold criteria for the performance improvement using the proposed splines model and <italic>R</italic><sup>2 </sup>in GSEA, we use Figure <xref ref-type="fig" rid="F2">2</xref> as a qualitative support. we calculate the square of the Pearson correlation (<italic>r</italic><sup>2</sup>) between ALT and each gene, which is equal to the <italic>R</italic><sup>2 </sup>from a simple linear model. We plot the 20500 genes' percentiles based on <italic>r</italic><sup>2 </sup>and on our proposed <italic>R</italic><sup>2 </sup>for one compound, diquat in liver (Figure <xref ref-type="fig" rid="F2">2</xref>, panel 1). The percentiles/ranks of genes are very important for identifying either differentially expressed genes or gene sets associated with phenotypic changes. The departure of the dots from the diagonal in the figure indicates a large difference in the percentiles/ranks based on the two quantities and the necessity of accommodating non-linear trends. To eliminate the possibility that the departure is simply due to the extra degrees of freedom in non-linear model, we randomly permuted the ALTs and calculated <italic>R</italic><sup>2 </sup>- <italic>r</italic><sup>2 </sup>for all genes (Figure <xref ref-type="fig" rid="F2">2</xref>, panel 2). The range of observed <italic>R</italic><sup>2 </sup>- <italic>r</italic><sup>2 </sup>is much wider than that of randomly permuted data set. For genes that have a large observed <italic>R</italic><sup>2 </sup>- <italic>r</italic><sup>2 </sup>values, their non-linear association is better captured by using <italic>R</italic><sup>2 </sup>and ranks would change greatly by using non-linear model. Similar patterns were observed for the other compounds in both tissues.</p><fig position="float" id="F2"><label>Figure 2</label><caption><p><bold>(a) Genes' percentiles based on <italic>R</italic><sup>2 </sup>and the square of Pearson correlation (<italic>r</italic><sup>2</sup>).</bold> Gray dots show (<italic>R</italic><sup>2</sup>, <italic>r</italic><sup>2</sup>) and the solid line is a smoothing (lowess) line. The dashed line is <italic>y </italic>= <italic>x</italic>. (b) Observed <italic>R</italic><sup>2 </sup>- <italic>r</italic><sup>2 </sup>vs randomly generated <italic>R</italic><sup>2 </sup>- <italic>r</italic><sup>2</sup>. The dashed line is <italic>y </italic>= <italic>x</italic>.</p></caption><graphic xlink:href="1471-2105-9-481-2"/></fig><p>To build enrichment scores (ES) indicating the associations between ALT and gene sets from <italic>R</italic><sup>2</sup>, pre-built gene sets are needed. A total of 466 pre-built gene sets are prepared with methods detailed in additional file <xref ref-type="supplementary-material" rid="S1">1</xref>, section 2. In our implementation, each compound is analyzed separately in each tissue. As described in Section 2.2, we obtain 466 p-values (one per gene set) for each of 8 compounds per tissue under the null hypothesis that the gene expression levels in the tissue are not associated with ALT for this compound.</p><p>Let <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M21" name="1471-2105-9-481-i14" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> be the p-value of set <italic>s </italic>for compound <italic>c </italic>in liver and <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M22" name="1471-2105-9-481-i15" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> in blood. To call one set significant, we require at least 6 of 8 (a subjective definition of "most") p-values <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M23" name="1471-2105-9-481-i16" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>&#x022ef;</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mn>8</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula> be less than <italic>p</italic><sub>0</sub>, i.e., <italic>M </italic>= 6, <italic>C </italic>= 8. In this article, we use <italic>p</italic><sub>0 </sub>= 0.05 and 0:1 such that the number of identified gene sets are manageable.</p><p>Using formula (3),</p><p><disp-formula><italic>&#x003b1;</italic><sub><italic>L</italic></sub>(0.05) = <italic>&#x003b1;</italic><sub><italic>B</italic></sub>(0.05) = 4.0 &#x000d7; 10<sup>-7</sup>, <italic>&#x003b1;</italic><sub><italic>L</italic></sub>(0.1) = <italic>&#x003b1;</italic><sub><italic>B</italic></sub>(0.1) = 2.3 &#x000d7; 10<sup>-5</sup></disp-formula></p><p>To identify gene sets that are associated with ALT changes in both liver and blood, we require that at least 6 of 8 p-value pairs (<inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M24" name="1471-2105-9-481-i14" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula>, <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M25" name="1471-2105-9-481-i15" overflow="scroll"><mml:semantics><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:mrow></mml:semantics></mml:math></inline-formula>) satisfy that both values are less than <italic>p</italic><sub>0</sub>.</p><p><disp-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M26" name="1471-2105-9-481-i17" overflow="scroll"><mml:semantics><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>s</mml:mi><mml:mo>:</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>8</mml:mn></mml:munderover><mml:mrow><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mo>&#x0003c;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mtext>&#x000a0;and&#x000a0;</mml:mtext><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mi>B</mml:mi></mml:msubsup><mml:mo>&#x0003c;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02265;</mml:mo><mml:mn>6</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:semantics></mml:math></disp-formula></p><p>By definition, we have <italic>A</italic><sub><italic>LB</italic></sub>(<italic>p</italic><sub>0</sub>) &#x02286; <italic>A</italic><sub><italic>L</italic></sub>(<italic>p</italic><sub>0</sub>), <italic>A</italic><sub><italic>LB</italic></sub>(<italic>p</italic><sub>0</sub>) &#x02286; <italic>A</italic><sub><italic>B</italic></sub>(<italic>p</italic><sub>0</sub>) and if <italic>p</italic><sub>0 </sub>&#x02264; <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M27" name="1471-2105-9-481-i18" overflow="scroll"><mml:semantics><mml:mrow><mml:msub><mml:msup><mml:mi>p</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msup><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:semantics></mml:math></inline-formula>, <italic>A</italic><sub><italic>l</italic></sub>(<italic>p</italic><sub>0</sub>) &#x02286; <italic>A</italic><sub><italic>l</italic></sub>(<inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M28" name="1471-2105-9-481-i18" overflow="scroll"><mml:semantics><mml:mrow><mml:msub><mml:msup><mml:mi>p</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msup><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:semantics></mml:math></inline-formula>), <italic>l </italic>= <italic>L</italic>, <italic>B</italic>, <italic>LB</italic>. Generally, we have</p><p><disp-formula><italic>&#x003b1;</italic><sub><italic>LB</italic></sub>(0.05) &#x02264; <italic>&#x003b1;</italic><sub><italic>L</italic></sub>(0.05) = 4.0 &#x000d7; 10<sup>-7</sup>, <italic>&#x003b1;</italic><sub><italic>LB</italic></sub>(0.1) &#x02264; <italic>&#x003b1;</italic><sub><italic>L</italic></sub>(0.1) = 2.3 &#x000d7; 10<sup>-5</sup></disp-formula></p><p>In NCT compendium data, no direct associations were observed between gene expressions in liver and in blood. This can due to different response mechanisms to stressors or time lag between liver and blood, which can not be verified with sparse time points. With this observation, we can further assume the independence of gene expressions between tissues. Under the null hypothesis that the gene set is not associated with liver injury for any compound and tissue, we have independence between the tissues and the compounds. Similar to formula (3), type I error rate is</p><p><disp-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M29" name="1471-2105-9-481-i19" overflow="scroll"><mml:semantics><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02264;</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>8</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>8</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>7</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>&#x000d7;</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>7</mml:mn></mml:msup><mml:mo>&#x000d7;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>8</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>6</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>&#x000d7;</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>6</mml:mn></mml:msup><mml:mo>&#x000d7;</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>0.05</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>7</mml:mn><mml:mo>&#x000d7;</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>15</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>0.1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>2.8</mml:mn><mml:mo>&#x000d7;</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>11</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:semantics></mml:math></disp-formula></p><sec><title>2.4.1 Analysis results</title><p>In general, sets are more significant in liver than in blood. Using <italic>p</italic><sub>0 </sub>= 0.05, we identified 38 gene sets (<italic>A</italic><sub><italic>L</italic></sub>(0.05)) in liver and 2 gene sets (<italic>A</italic><sub><italic>B</italic></sub>(0.05)) in blood. Five sets are identified for <italic>A</italic><sub><italic>LB</italic></sub>(0.1) while none of them attain the criteria of <italic>A</italic><sub><italic>LB</italic></sub>(0.05). The FDR bound (Equation 4) for all reported <italic>A</italic><sub><italic>l</italic></sub>(<italic>p</italic><sub>0</sub>), <italic>l </italic>= <italic>L</italic>, <italic>B</italic>, <italic>LB</italic>, <italic>p</italic><sub>0 </sub>= 0.05, 0.1 are smaller than 4 &#x000d7; 10<sup>-4</sup>. Biological interpretation of these sets are provided in additional file <xref ref-type="supplementary-material" rid="S1">1</xref>, section 3.</p><p>We note that by setting <italic>p</italic><sub>0 </sub>= 0.05 and 0:1, we have used a relatively conservative approach to select a small number of the most significant sets that represent good candidates for further study. For completeness, we provide all intermediate results from step 2 in the additional file <xref ref-type="supplementary-material" rid="S2">2</xref> (and available upon request).</p><p>We also carried out a two-way (gene expression and ALT) clustering analysis using software <italic>Cluster </italic>[<xref ref-type="bibr" rid="B35">35</xref>] for each of the 5 sets from <italic>A</italic><sub><italic>LB</italic></sub>(0.1). Heat maps are provided in the additional file <xref ref-type="supplementary-material" rid="S3">3</xref>. One can see that liver and blood have different patterns of gene expression, supporting our procedure of analyzing liver and blood separately. In addition, this difference suggests that it would be difficult to use blood gene expression to predict liver gene expression or vice versa in this data set. Some identified sets contain both genes positively or negatively correlated to ALT, indicating that in calculating ES values for general GSEA/SAFE procedure, genes should be ranked according the absolute value of their associations to the phenotypic endpoint.</p><p>When using Pearson correlation to account for linear association, an identified set can have many genes linearly associated to the phenotype and so these associated genes are likely to associate each other linearly. We present in Figure <xref ref-type="fig" rid="F3">3</xref> rich association relations between genes with one of identified sets, <italic>glycolysis and gluconeogenesis </italic>with liver gene expression data in monocrotaline. The figures for other compounds are provided in the additional file <xref ref-type="supplementary-material" rid="S4">4</xref>. The figures show that for the genes in the same biological pathway, linear functions are far from enough to describe the association patterns between genes. Both positive, negative and non-monotone association between genes are observed in the presented pathway. This observation indicates that we need to be careful in using signed association measurements to build global statistics. Rather than cumulating the association strength of genes in the set, it is possible that positive and negative associations will cancel out each other.</p><fig position="float" id="F3"><label>Figure 3</label><caption><p><bold>Rich association types between genes in gene set <italic>glycolysis and gluconeogenesis</italic>.</bold> X-axis is the expression level of the gene G6pc which has the largest standard deviation in the gene set. Y-axis is the expression level for all genes in the set. Natural cubic splines with 4 inner knots at quartiles are fitted using G6pc as the predictor variable. Data for monocrotaline in liver are used.</p></caption><graphic xlink:href="1471-2105-9-481-3"/></fig></sec><sec><title>2.4.2 Permutation size and method</title><p>Permutations have been widely used in microarray data analysis to establish the null distribution of the test statistics [<xref ref-type="bibr" rid="B4">4</xref>,<xref ref-type="bibr" rid="B5">5</xref>,<xref ref-type="bibr" rid="B36">36</xref>]. The number of permutations chosen depends on statistical assumptions and the inferential goal and procedure. The aggregation method assuming the same null for all gene sets requires much fewer (1,000) permutations [<xref ref-type="bibr" rid="B4">4</xref>] than would a gene set specific null (10,000) [<xref ref-type="bibr" rid="B5">5</xref>]. However, the same null assumption does not always hold and when computationally affordable, we prefer to use gene set specific null [<xref ref-type="bibr" rid="B5">5</xref>]. In this study, we use gene set specific null approach with only 1000 permutations due to computational restrains. Using the example shown in the manual of <italic>R </italic>package <italic>SAFE </italic>[<xref ref-type="bibr" rid="B37">37</xref>] in Bioconductor [<xref ref-type="bibr" rid="B38">38</xref>] released with [<xref ref-type="bibr" rid="B5">5</xref>], we observe that the Yekutieli-Benjamini's resampling based FDR estimate [<xref ref-type="bibr" rid="B39">39</xref>] for a specific set [<xref ref-type="bibr" rid="B32">32</xref>] can range from 0.09 to 0.38 with different random seeds and a permutation size 1000. This illustrates the need to use a large number of permutations when setting the threshold based on a quantity requiring a good estimate of the p-value and motivated us to check whether permutation number 1000 is large enough in our study.</p><p>In our study, we bounded FDR rather than providing the set-specific FDR. With a relatively large threshold <italic>p</italic><sub>0 </sub>(0.05 and 0.1), the compound-tissue-wise p-value estimation does not require high precision. We checked the reproducibility of our results with another 1000 permutations using a different random seed (Table <xref ref-type="table" rid="T2">2</xref>). The identified gene sets from two runs are quite consistent except for <italic>A</italic><sub><italic>B</italic></sub>(0.05) where the identified sets marginally satisfy the selection criterion.</p><table-wrap position="float" id="T2"><label>Table 2</label><caption><p>The number of identified sets and overlaps of two runs.</p></caption><table frame="hsides" rules="groups"><thead><tr><td></td><td align="center">Random seed 1</td><td align="center">Random seed 2</td><td align="center">Overlap</td></tr></thead><tbody><tr><td align="left">|<italic>A</italic><sub><italic>L</italic></sub>(0.05)|</td><td align="center">38</td><td align="center">37</td><td align="center">36</td></tr><tr><td align="left">|<italic>A</italic><sub><italic>B</italic></sub>(0.05)|</td><td align="center">2</td><td align="center">5</td><td align="center">2</td></tr><tr><td align="left">|<italic>A</italic><sub><italic>LB</italic></sub>(0.05)|</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="left">|<italic>A</italic><sub><italic>L</italic></sub>(0.1)|</td><td align="center">74</td><td align="center">70</td><td align="center">68</td></tr><tr><td align="left">|<italic>A</italic><sub><italic>B</italic></sub>(0.1)|</td><td align="center">28</td><td align="center">30</td><td align="center">27</td></tr><tr><td align="left">|<italic>A</italic><sub><italic>LB</italic></sub>(0.1)|</td><td align="center">5</td><td align="center">5</td><td align="center">5</td></tr></tbody></table></table-wrap><p>We randomly permuted the outcome variable ALT to generate the null distribution of ES. However, for a particular compound, samples taken at the same time point shared one control group. This raises the possibility that the observed association between ALT and gene expression might be influenced by the resulting statistical dependency. To evaluate this possibility, we redid the permutation while keeping the dependency structure. For example, in case of compound 1,4-dichlorobenzene, there are 3 dose levels and 3 time points, 4 replicates for each dose-time combination. The 12 samples for each time point sharing the same controls comprise a group. We randomly matched groups of ALT levels with groups of gene expression levels. There are a total of 3! = 6 possible group matches. In each matched group of 12 samples, we then randomly permuted ALT levels. Among the eight compounds, two did not have balanced subgroups for this type of permutation. We thus used only the other 6 compounds and ran this two-stage permutation 1000 times to generate 1000 "null" data sets per compound per tissue.</p><p>Since we only have 6 compounds in the new permutations, we cannot apply the "6 of 8" criterion to identify associated sets in the new permutation results. However, the Pearson correlation and Spearman rank correlation of <italic>P </italic>(and <italic>Z</italic>) values between the two permutations in each compound and tissue are all higher than 0.96, indicating the strong consistency of results between the two different permutation strategies. Thus our identified sets based on p-values would be almost the same with the two permutations methods.</p></sec></sec></sec><sec><title>Conclusion</title><p>We present an inferential framework for selecting gene sets that are associated with a continuous phenotypic endpoint for microarray data with multiple categories of experimental conditions. We proceed in three steps: 1) compute gene specific <italic>R</italic><sup>2 </sup>between gene expression and endpoints for each individual category; 2) score the association of sets of genes with endpoints based on the gene specific association measurements; 3) combine category specific inference results to identify sets of genes that are associated with endpoint in most of the categories. When the phenotype is binary, many statistics used for identifying differentially expressed genes can be used in step 1. However, these statistics might not work well for continuous and non-linear/non-monotonic relationships between endpoint and gene expression. Based on natural cubic spline regression, our proposed <italic>R</italic><sup>2 </sup>not only captures non-linear associations between endpoint and gene expression but also accommodates any existing linear association between the two variables. In step 2, we adapt the framework of GSEA/SAFE using our <italic>R</italic><sup>2 </sup>as the association measurement. The combination of steps 1 and 2 can be regarded as a special case of the GSEA/SAFE procedure in a generalized sense. In step 3, we combine the results from multiple categories for each gene set and give a conservative FDR upper bound. This step depends on a subjective choice of threshold that can be tailored to the inferential goal. Different thresholds would result in different numbers of significant sets.</p><p>Assuming that the experimental information is fully represented by gene expression levels (Equation 1), we calculate the gene specific <italic>R</italic><sup>2 </sup>separately for each category. For some genes, this assumption might be violated if the curves relating gene expression level and endpoints are different for the same category at different experimental conditions. In this case, a pooled approach inside each category might yield reduced <italic>R</italic><sup>2 </sup>values. However, limited sample size of the category might not allow splitting the data into subcategories. Also, the curve (<italic>X</italic><sub><italic>ij</italic></sub>, <italic>Y</italic><sub><italic>i</italic></sub>) itself is driven by the experimental conditions, e.g., time and dose. If we fix all these factors, then pairs (<italic>X</italic><sub><italic>ij</italic></sub>, <italic>Y</italic><sub><italic>i</italic></sub>) may distribute around an average point and we would not be able to capture the main association trend.</p><p>We use the quantity <italic>R</italic><sup>2 </sup>to screen strong associations between endpoint and gene expression levels rather than to select the best model for predicting the endpoint from the gene expression level. Since the spline's degrees of freedom is fixed, it is not necessary to use a penalty term to control over-fitting. Finer model adjustment for purposes beyond screening can be considered after associated gene sets are identified.</p><p>We illustrate our method using the NCT compendium data in which the expression values from 20,500 genes in both rat liver and blood were analyzed at 3&#x02013;4 dose levels and 3 time points for 8 hepatotoxicants. We are interested in identifying pre-defined gene sets that are associated with liver injury indicated by the ALT activity level in blood for most of the 8 hepatotoxicants. For this compendium data, we did observe non-linear association between ALT and gene expression. This might be due to the fact that ALT level increases as the degree of liver injury increases and, on the other side, the gene expression levels can be either up-regulated or down-regulated.</p><p>In the data example, we fixed 4 inner knots at 20%, 40%, 60%, and 80% quantiles of the gene expression. This model space was selected by manually examining scatter plots between gene expression levels and ALT levels. We believe that this model space is rich enough to account for biologically plausible non-linear/non-monotonic trend. If extra degrees of freedom are desired, a graph similar to Figure <xref ref-type="fig" rid="F2">2</xref> can be used to evaluate the benefits. Although our proposed <italic>R</italic><sup>2 </sup>can capture non-linear associations between ALT and gene expression and lead to biologically meaningful inferences, computational feasibility restricts us from considering more complicated models, e.g., with two or more genes jointly in the model. While a high <italic>R</italic><sup>2 </sup>indicates strong association, a low <italic>R</italic><sup>2 </sup>does not always imply no association. Also, weak association may not be well captured by <italic>R</italic><sup>2</sup>. However, this concern is alleviated in GSEA/SAFE procedure, because the method is designed to accumulate the weak local signals from individual genes into a stronger global signal at gene set level.</p><p>We compare the <italic>R</italic><sup>2 </sup>from a non-linear model and a linear model in Figure <xref ref-type="fig" rid="F2">2</xref> to illustrate the need for using a non-linear model. Further performance comparison based on identified sets is difficult without knowing the true state of nature of whether a specific gene set is associated with the phenotypic endpoint. Also, we believe that in our case, it will not provide a very helpful reference to pursue a computational simulation, which has to include arguable assumptions that expressions of genes from one pathway follow some convenient multivariate distribution (e.g., multivariate normal distribution) and the outcome variable follows a skew distribution. As shown in the additional file <xref ref-type="supplementary-material" rid="S1">1</xref>, section 1, the null distributions of <italic>R</italic><sup>2 </sup>will be very sensitive to these assumptions.</p><p>In summary, we describe a framework of GSEA/SAFE for microarray data in which the gene expression data were generated under multiple categories of experimental conditions and the phenotypic endpoint was continuous. The proposed association measure <italic>R</italic><sup>2 </sup>successfully captured non-linear trends between the gene expression levels and endpoint. The <italic>R</italic><sup>2 </sup>was then incorporated into the GSEA/SAFE procedure in per category analysis. The usage of <italic>R</italic><sup>2 </sup>has the advantage over the t-statistics or Pearson correlation in identifying the gene sets with both genes positively and negatively correlated to endpoints. Inference across categories serves to identify gene sets, and the corresponding functional pathways whose alteration plays a role in related biological mechanism. Our method is general and can be applied to GSEA/SAFE analysis of microarray data with other continuous phenotype or multiple GSEA/SAFE analyses.</p><p>Finally, it is important to note that, in GSEA/SAFE analyses, global statistics is usually designed to test whether the distribution of local statistics within a gene set is different from that of genes outside the gene set. Proper local statistics and global statistics should be selected carefully to avoid the situation where a gene set is statistically significant but actually clusters in a region of weak association in the gene list and is off biological interest. In this article, we have used unsigned local statistics <italic>R</italic><sup>2</sup>, signed global statistics and one-side p-value to eliminate this possibility.</p></sec><sec><title>Competing interests</title><p>The authors declare that they have no competing interests.</p></sec><sec><title>Authors' contributions</title><p>RL and LL conceived and designed the study and RL performed all analyses. SD prepared the rat gene set data. RI, AH, and GB provided biological interpretation of the results. RL and LL wrote the paper.</p></sec><sec sec-type="supplementary-material"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="S1"><caption><title>Additional file 1</title><p><bold>Supplement: Gene Set Enrichment Analysis for non-monotone association and multiple experimental categories.</bold> The file includes three sections: 1, the exploration on distribution of <italic>R</italic><sup>2 </sup>under permutation; 2, gene set data preparation; 3. identified gene sets and biological interpretation.</p></caption><media xlink:href="1471-2105-9-481-S1.pdf" mimetype="application" mime-subtype="pdf"><caption><p>Click here for file</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="S2"><caption><title>Additional file 2</title><p><bold>Sets and Expression.</bold> The intermediate analysis results of NCT compendium data set. Sets directory contains lists of identified gene sets under different across-compound (category) selection criteria. Compound specific p-values, set size, etc are provided. Expression directory contains extracted expression data for respective identified gene sets.</p></caption><media xlink:href="1471-2105-9-481-S2.zip" mimetype="application" mime-subtype="x-zip-compressed"><caption><p>Click here for file</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="S3"><caption><title>Additional file 3</title><p><bold>Heat maps of sets in <italic>A</italic><sub><italic>LB</italic></sub>(0:1).</bold> Heat maps of gene sets in <italic>A</italic><sub><italic>LB</italic></sub>(0:1). Both liver and blood data are presented for each identified set. Alt level is included after log10 transformation.</p></caption><media xlink:href="1471-2105-9-481-S3.ppt" mimetype="application" mime-subtype="vnd.ms-powerpoint"><caption><p>Click here for file</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="S4"><caption><title>Additional file 4</title><p><bold>Associations between genes in the identified set <italic>glycolysis and gluconeogenesis </italic>for liver data.</bold> Figures that show associations between genes in the identified set <italic>glycolysis and gluconeogenesis </italic>for liver data. All 8 compounds are presented, including <italic>monocrotaline </italic>(Figure <xref ref-type="fig" rid="F3">3</xref> in the article).</p></caption><media xlink:href="1471-2105-9-481-S4.pdf" mimetype="application" mime-subtype="pdf"><caption><p>Click here for file</p></caption></media></supplementary-material></sec></body><back><ack><sec><title>Acknowledgements</title><p>This research was supported by the Intramural Research Program of the NIH, National Institute of Environmental Health Sciences. We thank the NCT for the compendium data used in this analysis. We thank Clarice Weinberg, David Umbach and Grace Kissling for insightful discussion and for critically reading the manuscript. We thank Shyamal Peddada, Dmitri Zaykin and Bhanu Singh for helpful discussion. We thank Robert Bass for creating the web site for R code downloading. We thank the Computational Biology Facility at NIEHS for computing time. We also thank anonymous referees for helpful comments which greatly improve our work.</p></sec></ack><ref-list><ref id="B1"><citation citation-type="other"><person-group person-group-type="author"><name><surname>Parmigiani</surname><given-names>G</given-names></name><name><surname>Garrett</surname><given-names>ES</given-names></name><name><surname>Irizarry</surname><given-names>RA</given-names></name><name><surname>Zeger</surname><given-names>SL</given-names></name><collab>(Eds)</collab></person-group><source>The Analysis of Gene Expression Data Springer</source><year>2003</year></citation></ref><ref id="B2"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Smyth</surname><given-names>GK</given-names></name><name><surname>Yang</surname><given-names>YH</given-names></name><name><surname>Speed</surname><given-names>T</given-names></name></person-group><article-title>Statistical issues in cDNA microarray data analysis</article-title><source>Methods Mol Biol</source><year>2003</year><volume>224</volume><fpage>111</fpage><lpage>136</lpage><pub-id pub-id-type="pmid">12710670</pub-id></citation></ref><ref id="B3"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Mootha</surname><given-names>VK</given-names></name><name><surname>Lindgren</surname><given-names>CM</given-names></name><name><surname>Eriksson</surname><given-names>KF</given-names></name><name><surname>Subramanian</surname><given-names>A</given-names></name><name><surname>Sihag</surname><given-names>S</given-names></name><name><surname>Lehar</surname><given-names>J</given-names></name><name><surname>Puigserver</surname><given-names>P</given-names></name><name><surname>Carlsson</surname><given-names>E</given-names></name><name><surname>Ridderstrale</surname><given-names>M</given-names></name><name><surname>Laurila</surname><given-names>E</given-names></name><name><surname>Houstis</surname><given-names>N</given-names></name><name><surname>Daly</surname><given-names>MJ</given-names></name><name><surname>Patterson</surname><given-names>N</given-names></name><name><surname>Mesirov</surname><given-names>JP</given-names></name><name><surname>Golub</surname><given-names>TR</given-names></name><name><surname>Tamayo</surname><given-names>P</given-names></name><name><surname>Spiegelman</surname><given-names>B</given-names></name><name><surname>Lander</surname><given-names>ES</given-names></name><name><surname>Hirschhorn</surname><given-names>JN</given-names></name><name><surname>Altshuler</surname><given-names>D</given-names></name><name><surname>Groop</surname><given-names>LC</given-names></name></person-group><article-title>PGC-1alpha-responsive genes involved in oxidative phosphorylation are coordinately downregulated in human diabetes</article-title><source>Nat Genet</source><year>2003</year><volume>34</volume><fpage>267</fpage><lpage>273</lpage><pub-id pub-id-type="pmid">12808457</pub-id><pub-id pub-id-type="doi">10.1038/ng1180</pub-id></citation></ref><ref id="B4"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Subramanian</surname><given-names>A</given-names></name><name><surname>Tamayo</surname><given-names>P</given-names></name><name><surname>Mootha</surname><given-names>VK</given-names></name><name><surname>Mukherjee</surname><given-names>S</given-names></name><name><surname>Ebert</surname><given-names>BL</given-names></name><name><surname>Gillette</surname><given-names>MA</given-names></name><name><surname>Paulovich</surname><given-names>A</given-names></name><name><surname>Pomeroy</surname><given-names>SL</given-names></name><name><surname>Golub</surname><given-names>TR</given-names></name><name><surname>Lander</surname><given-names>ES</given-names></name><name><surname>Mesirov</surname><given-names>JP</given-names></name></person-group><article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title><source>Proc Natl Acad Sci USA</source><year>2005</year><volume>102</volume><fpage>15545</fpage><lpage>15550</lpage><pub-id pub-id-type="pmid">16199517</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id></citation></ref><ref id="B5"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Barry</surname><given-names>WT</given-names></name><name><surname>Nobel</surname><given-names>AB</given-names></name><name><surname>Wright</surname><given-names>FA</given-names></name></person-group><article-title>Significance analysis of functional categories in gene expression studies: a structured permutation approach</article-title><source>Bioinformatics</source><year>2005</year><volume>21</volume><fpage>1943</fpage><lpage>1949</lpage><pub-id pub-id-type="pmid">15647293</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/bti260</pub-id></citation></ref><ref id="B6"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Edelman</surname><given-names>E</given-names></name><name><surname>Porrello</surname><given-names>A</given-names></name><name><surname>Guinney</surname><given-names>J</given-names></name><name><surname>Balakumaran</surname><given-names>B</given-names></name><name><surname>Bild</surname><given-names>A</given-names></name><name><surname>Febbo</surname><given-names>PG</given-names></name><name><surname>Mukherjee</surname><given-names>S</given-names></name></person-group><article-title>Analysis of sample set enrichment scores: assaying the enrichment of sets of genes for individual samples in genome-wide expression profiles</article-title><source>Bioinformatics</source><year>2006</year><volume>22</volume><fpage>e108</fpage><lpage>e116</lpage><pub-id pub-id-type="pmid">16873460</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btl231</pub-id></citation></ref><ref id="B7"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Tian</surname><given-names>L</given-names></name><name><surname>Greenberg</surname><given-names>SA</given-names></name><name><surname>Kong</surname><given-names>SW</given-names></name><name><surname>Altschuler</surname><given-names>J</given-names></name><name><surname>Kohane</surname><given-names>IS</given-names></name><name><surname>Park</surname><given-names>PJ</given-names></name></person-group><article-title>Discovering statistically significant pathways in expression profiling studies</article-title><source>Proc Natl Acad Sci USA</source><year>2005</year><volume>102</volume><fpage>13544</fpage><lpage>13549</lpage><pub-id pub-id-type="pmid">16174746</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0506577102</pub-id></citation></ref><ref id="B8"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Goeman</surname><given-names>JJ</given-names></name><name><surname>B&#x000fc;hlmann</surname><given-names>P</given-names></name></person-group><article-title>Analyzing gene expression data in terms of gene sets: methodological issues</article-title><source>Bioinformatics</source><year>2007</year><volume>23</volume><fpage>980</fpage><lpage>987</lpage><pub-id pub-id-type="pmid">17303618</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btm051</pub-id></citation></ref><ref id="B9"><citation citation-type="other"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>JJ</given-names></name><name><surname>Lee</surname><given-names>T</given-names></name><name><surname>Delongchamp</surname><given-names>RR</given-names></name><name><surname>Chen</surname><given-names>T</given-names></name><name><surname>Tsai</surname><given-names>CA</given-names></name></person-group><article-title>Significant Analysis of Groups of Genes in Expression Profiling Studies</article-title><source>Bioinformatics</source><year>2007</year></citation></ref><ref id="B10"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Jiang</surname><given-names>Z</given-names></name><name><surname>Gentleman</surname><given-names>R</given-names></name></person-group><article-title>Extensions to gene set enrichment</article-title><source>Bioinformatics</source><year>2007</year><volume>23</volume><fpage>306</fpage><lpage>313</lpage><pub-id pub-id-type="pmid">17127676</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btl599</pub-id></citation></ref><ref id="B11"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Gold</surname><given-names>DL</given-names></name><name><surname>Coombes</surname><given-names>KR</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name><name><surname>Mallick</surname><given-names>B</given-names></name></person-group><article-title>Enrichment analysis in high-throughput genomics &#x02013; accounting for dependency in the NULL</article-title><source>Brief Bioinform</source><year>2007</year><volume>8</volume><fpage>71</fpage><lpage>77</lpage><pub-id pub-id-type="pmid">17077137</pub-id><pub-id pub-id-type="doi">10.1093/bib/bbl019</pub-id></citation></ref><ref id="B12"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Tusher</surname><given-names>VG</given-names></name><name><surname>Tibshirani</surname><given-names>R</given-names></name><name><surname>Chu</surname><given-names>G</given-names></name></person-group><article-title>Significance analysis of microarrays applied to the ionizing radiation response</article-title><source>Procedings of National Academy of Sciences</source><year>2001</year><volume>98</volume><fpage>5116</fpage><lpage>5121</lpage><pub-id pub-id-type="doi">10.1073/pnas.091062498</pub-id></citation></ref><ref id="B13"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Efron</surname><given-names>B</given-names></name><name><surname>Tibshirani</surname><given-names>R</given-names></name><name><surname>Storey</surname><given-names>JD</given-names></name><name><surname>Tusher</surname><given-names>V</given-names></name></person-group><article-title>Empirical Bayes analysis of a microarray experiment</article-title><source>Journal of the American Statistical Association</source><year>2001</year><volume>96</volume><fpage>1151</fpage><lpage>1160</lpage><pub-id pub-id-type="doi">10.1198/016214501753382129</pub-id></citation></ref><ref id="B14"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>L&#x000f6;nnstedt</surname><given-names>I</given-names></name><name><surname>Speed</surname><given-names>T</given-names></name></person-group><article-title>Replicated microarray data</article-title><source>Statistica Sinica</source><year>2002</year><volume>12</volume><fpage>31</fpage><lpage>46</lpage></citation></ref><ref id="B15"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>Linear Models and Empirical Bayes Methods for Assessing Differential Expression in Microarray Experiments</article-title><source>Statistical Applications in Genetics and Molecular Biology</source><year>2004</year><volume>3</volume><ext-link ext-link-type="uri" xlink:href="Http://www.bepress.com/sagmb/vol3/iss1/art3"/></citation></ref><ref id="B16"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Cui</surname><given-names>X</given-names></name><name><surname>Hwang</surname><given-names>JTG</given-names></name><name><surname>Qiu</surname><given-names>J</given-names></name><name><surname>Blades</surname><given-names>NJ</given-names></name><name><surname>Churchill</surname><given-names>GA</given-names></name></person-group><article-title>Improved statistical tests for differential gene expression by shrinking variance components estimates</article-title><source>Biostatistics</source><year>2005</year><volume>6</volume><fpage>59</fpage><lpage>75</lpage><pub-id pub-id-type="pmid">15618528</pub-id><pub-id pub-id-type="doi">10.1093/biostatistics/kxh018</pub-id></citation></ref><ref id="B17"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Newton</surname><given-names>MA</given-names></name><name><surname>Noueiry</surname><given-names>A</given-names></name><name><surname>Sarkar</surname><given-names>D</given-names></name><name><surname>Ahlquist</surname><given-names>P</given-names></name></person-group><article-title>Detecting differential gene expression with a semiparametric hierarchial mixture method</article-title><source>Biostatistics</source><year>2004</year><volume>5</volume><fpage>155</fpage><lpage>176</lpage><pub-id pub-id-type="pmid">15054023</pub-id><pub-id pub-id-type="doi">10.1093/biostatistics/5.2.155</pub-id></citation></ref><ref id="B18"><citation citation-type="book"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>SM</given-names></name><name><surname>Johnson</surname><given-names>KF</given-names></name></person-group><source>A practical approach to microarray data analysis</source><publisher-name>Kluwer Academic Publishers 2003 chap. Correlation and Association Analysis</publisher-name><fpage>289</fpage><lpage>305</lpage></citation></ref><ref id="B19"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Irwin</surname><given-names>RD</given-names></name><name><surname>Boorman</surname><given-names>GA</given-names></name><name><surname>Cunningham</surname><given-names>ML</given-names></name><name><surname>Heinloth</surname><given-names>AN</given-names></name><name><surname>Malarkey</surname><given-names>DE</given-names></name><name><surname>Paules</surname><given-names>RS</given-names></name></person-group><article-title>Application of toxicogenomics to toxicology: basic concepts in the analysis of microarray data</article-title><source>Toxicol Pathol</source><year>2004</year><volume>32</volume><fpage>72</fpage><lpage>83</lpage><pub-id pub-id-type="pmid">15209406</pub-id><pub-id pub-id-type="doi">10.1080/01926230490424752</pub-id></citation></ref><ref id="B20"><citation citation-type="book"><person-group person-group-type="author"><name><surname>De Boor</surname><given-names>C</given-names></name></person-group><source>A practical guide to splines</source><year>2001</year><publisher-name>Springer, revised edition</publisher-name></citation></ref><ref id="B21"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Doksum</surname><given-names>K</given-names></name><name><surname>Blyth</surname><given-names>S</given-names></name><name><surname>Bradlow</surname><given-names>E</given-names></name><name><surname>Meng</surname><given-names>XL</given-names></name><name><surname>Zhao</surname><given-names>H</given-names></name></person-group><article-title>Correlation Curves As Local Measures of Variance Explained by Regression</article-title><source>Journal of the American Statistical Association</source><year>1994</year><volume>89</volume><fpage>571</fpage><lpage>582</lpage><pub-id pub-id-type="doi">10.2307/2290860</pub-id></citation></ref><ref id="B22"><citation citation-type="book"><person-group person-group-type="author"><name><surname>Hastie</surname><given-names>T</given-names></name><name><surname>Tibshirani</surname><given-names>R</given-names></name></person-group><source>Generalized Additive Models</source><year>1999</year><publisher-name>Chapman &#x00026; Hall Ltd</publisher-name></citation></ref><ref id="B23"><citation citation-type="book"><person-group person-group-type="author"><collab>R Development Core Team</collab></person-group><source>R: A language and environment for statistical computing</source><year>2005</year><publisher-name>R Foundation for Statistical Computing, Vienna, Austria</publisher-name><ext-link ext-link-type="uri" xlink:href="http://www.R-project.org"/></citation></ref><ref id="B24"><citation citation-type="book"><person-group person-group-type="author"><name><surname>Simonoff</surname><given-names>JS</given-names></name></person-group><source>Smoothing Methods in Statistics</source><year>1996</year><publisher-name>Springer-Verlag Inc</publisher-name></citation></ref><ref id="B25"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Frank</surname><given-names>IE</given-names></name></person-group><article-title>Modern nonlinear regression methods</article-title><source>Chemometrics and Intelligent Laboratory Systems</source><year>1995</year><volume>27</volume><fpage>1</fpage><lpage>9</lpage><pub-id pub-id-type="doi">10.1016/0169-7439(94)00005-4</pub-id></citation></ref><ref id="B26"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Goeman</surname><given-names>JJ</given-names></name><name><surname>Geer</surname><given-names>SA van de</given-names></name><name><surname>de Kort</surname><given-names>F</given-names></name><name><surname>van Houwelingen</surname><given-names>HC</given-names></name></person-group><article-title>A global test for groups of genes: testing association with a clinical outcome</article-title><source>Bioinformatics</source><year>2004</year><volume>20</volume><fpage>93</fpage><lpage>99</lpage><pub-id pub-id-type="pmid">14693814</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btg382</pub-id></citation></ref><ref id="B27"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Dinu</surname><given-names>I</given-names></name><name><surname>Potter</surname><given-names>JD</given-names></name><name><surname>Mueller</surname><given-names>T</given-names></name><name><surname>Liu</surname><given-names>Q</given-names></name><name><surname>Adewale</surname><given-names>AJ</given-names></name><name><surname>Jhangri</surname><given-names>GS</given-names></name><name><surname>Einecke</surname><given-names>G</given-names></name><name><surname>Famulski</surname><given-names>KS</given-names></name><name><surname>Halloran</surname><given-names>P</given-names></name><name><surname>Yasui</surname><given-names>Y</given-names></name></person-group><article-title>Improving gene set analysis of microarray data by SAM-GS</article-title><source>BMC Bioinformatics</source><year>2007</year><volume>8</volume><fpage>242</fpage><pub-id pub-id-type="pmid">17612399</pub-id><pub-id pub-id-type="doi">10.1186/1471-2105-8-242</pub-id></citation></ref><ref id="B28"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Damian</surname><given-names>D</given-names></name><name><surname>Gorfine</surname><given-names>M</given-names></name></person-group><article-title>Statistical concerns about the GSEA procedure</article-title><source>Nature Genetics</source><year>2004</year><volume>36</volume><fpage>663</fpage><pub-id pub-id-type="pmid">15226741</pub-id><pub-id pub-id-type="doi">10.1038/ng0704-663a</pub-id></citation></ref><ref id="B29"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Mootha</surname><given-names>VK</given-names></name><name><surname>Daly</surname><given-names>MJ</given-names></name><name><surname>Patterson</surname><given-names>N</given-names></name><name><surname>Hirchhorn</surname><given-names>JN</given-names></name><name><surname>Groop</surname><given-names>LC</given-names></name><name><surname>Altshuler</surname><given-names>D</given-names></name></person-group><article-title>In reply to Statistical concerns about the GSEA procedure</article-title><source>Nature Genetics</source><year>2004</year><volume>36</volume><fpage>663</fpage><pub-id pub-id-type="pmid">15226741</pub-id><pub-id pub-id-type="doi">10.1038/ng0704-663b</pub-id></citation></ref><ref id="B30"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Fisher</surname><given-names>RA</given-names></name></person-group><article-title>Question 14: Combining Independent Tests of Significance</article-title><source>The American Statistician</source><year>1948</year><volume>2,5</volume><fpage>30</fpage></citation></ref><ref id="B31"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Benjamini</surname><given-names>Y</given-names></name><name><surname>Hochberg</surname><given-names>Y</given-names></name></person-group><article-title>Controlling the false discovery rate: A practical and powerful approach to multiple testing</article-title><source>Journal of the Royal Statistical Society, Series B, Methodological</source><year>1995</year><volume>57</volume><fpage>289</fpage><lpage>300</lpage></citation></ref><ref id="B32"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Storey</surname><given-names>JD</given-names></name><name><surname>Tibshirani</surname><given-names>R</given-names></name></person-group><article-title>Statistical Significance for Genomewide Studies</article-title><source>Proceedings of the National Academy of Science</source><year>2003</year><volume>100</volume><fpage>9440</fpage><lpage>9445</lpage><pub-id pub-id-type="doi">10.1073/pnas.1530509100</pub-id></citation></ref><ref id="B33"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Fan</surname><given-names>J</given-names></name><name><surname>Ren</surname><given-names>Y</given-names></name></person-group><article-title>Statistical analysis of DNA microarray data in cancer research</article-title><source>Clin Cancer Res</source><year>2006</year><volume>12</volume><fpage>4469</fpage><lpage>4473</lpage><pub-id pub-id-type="pmid">16899590</pub-id><pub-id pub-id-type="doi">10.1158/1078-0432.CCR-06-1033</pub-id></citation></ref><ref id="B34"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Bushel</surname><given-names>PR</given-names></name><name><surname>Heinloth</surname><given-names>AN</given-names></name><name><surname>Li</surname><given-names>J</given-names></name><name><surname>Huang</surname><given-names>L</given-names></name><name><surname>Chou</surname><given-names>JW</given-names></name><name><surname>Boorman</surname><given-names>GA</given-names></name><name><surname>Malarkey</surname><given-names>DE</given-names></name><name><surname>Houle</surname><given-names>CD</given-names></name><name><surname>Ward</surname><given-names>SM</given-names></name><name><surname>Wilson</surname><given-names>RE</given-names></name><name><surname>Fannin</surname><given-names>RD</given-names></name><name><surname>Russo</surname><given-names>MW</given-names></name><name><surname>Watkins</surname><given-names>PB</given-names></name><name><surname>Tennant</surname><given-names>RW</given-names></name><name><surname>Paules</surname><given-names>RS</given-names></name></person-group><article-title>Blood gene expression signatures predict exposure levels</article-title><source>Proc Natl Acad Sci USA</source><year>2007</year><volume>104</volume><fpage>18211</fpage><lpage>18216</lpage><pub-id pub-id-type="pmid">17984051</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0706987104</pub-id></citation></ref><ref id="B35"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Eisen</surname><given-names>MB</given-names></name><name><surname>Spellman</surname><given-names>PT</given-names></name><name><surname>Brown</surname><given-names>PO</given-names></name><name><surname>Botstein</surname><given-names>D</given-names></name></person-group><article-title>Cluster analysis and display of genome-wide expression patterns</article-title><source>Proc Natl Acad Sci USA</source><year>1998</year><volume>95</volume><fpage>14863</fpage><lpage>14868</lpage><pub-id pub-id-type="pmid">9843981</pub-id><pub-id pub-id-type="doi">10.1073/pnas.95.25.14863</pub-id></citation></ref><ref id="B36"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Dudoit</surname><given-names>S</given-names></name><name><surname>Yang</surname><given-names>YH</given-names></name><name><surname>Callow</surname><given-names>MJ</given-names></name><name><surname>Speed</surname><given-names>TP</given-names></name></person-group><article-title>Statistical methods for identifying differentially expressed genes in replicated cDNA microarray experiments</article-title><source>Statistica Sinica</source><year>2002</year><volume>12</volume><fpage>111</fpage><lpage>139</lpage></citation></ref><ref id="B37"><citation citation-type="other"><person-group person-group-type="author"><name><surname>Barry</surname><given-names>WT</given-names></name></person-group><source>Significance Analysis of Function and Expression</source><year>2005</year></citation></ref><ref id="B38"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Gentleman</surname><given-names>RC</given-names></name><name><surname>Carey</surname><given-names>VJ</given-names></name><name><surname>Bates</surname><given-names>DM</given-names></name><name><surname>Bolstad</surname><given-names>B</given-names></name><name><surname>Dettling</surname><given-names>M</given-names></name><name><surname>Dudoit</surname><given-names>S</given-names></name><name><surname>Ellis</surname><given-names>B</given-names></name><name><surname>Gautier</surname><given-names>L</given-names></name><name><surname>Ge</surname><given-names>Y</given-names></name><name><surname>Gentry</surname><given-names>J</given-names></name><name><surname>Hornik</surname><given-names>K</given-names></name><name><surname>Hothorn</surname><given-names>T</given-names></name><name><surname>Huber</surname><given-names>W</given-names></name><name><surname>Iacus</surname><given-names>S</given-names></name><name><surname>Irizarry</surname><given-names>R</given-names></name><name><surname>Leisch</surname><given-names>F</given-names></name><name><surname>Li</surname><given-names>C</given-names></name><name><surname>Maechler</surname><given-names>M</given-names></name><name><surname>Rossini</surname><given-names>AJ</given-names></name><name><surname>Sawitzki</surname><given-names>G</given-names></name><name><surname>Smith</surname><given-names>C</given-names></name><name><surname>Smyth</surname><given-names>G</given-names></name><name><surname>Tierney</surname><given-names>L</given-names></name><name><surname>Yang</surname><given-names>JYH</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name></person-group><article-title>Bioconductor: open software development for computational biology and bioinformatics</article-title><source>Genome Biol</source><year>2004</year><volume>5</volume><pub-id pub-id-type="pmid">15461798</pub-id></citation></ref><ref id="B39"><citation citation-type="journal"><person-group person-group-type="author"><name><surname>Yekutieli</surname><given-names>D</given-names></name><name><surname>Benjamini</surname><given-names>Y</given-names></name></person-group><article-title>Resampling-based False Discovery Rate Controlling Multiple Test Procedures for Correlated Test Statistics</article-title><source>Journal of Statistical Planning and Inference</source><year>1999</year><volume>82</volume><fpage>171</fpage><lpage>196</lpage><pub-id pub-id-type="doi">10.1016/S0378-3758(99)00041-5</pub-id></citation></ref></ref-list></back></article>